<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repository Statistics Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
        }
        .card-header {
            background-color: rgb(82, 113, 129);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
        }
        .stats-container {
            padding: 20px;
        }
        .nav-pills .nav-link.active {
            background-color: rgb(82, 113, 129);
        }
        .nav-pills .nav-link {
            color: rgb(82, 113, 129);
        }
        .table-responsive {
            max-height: 400px;
            overflow-y: auto;
        }
        .guideline-violation {
            color: #dc3545;
        }
        .chart-container {
            height: 300px;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
    </style>
</head>
<body>
    <div class="container-fluid stats-container">
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="text-center mb-4">Repository Statistics Dashboard</h1>
                <div class="card">
                    <div class="card-body">
                        <form id="repo-form" class="row g-3">
                            <div class="col-md-5">
                                <label for="owner" class="form-label">Repository Owner</label>
                                <input type="text" class="form-control" id="owner" placeholder="e.g., ShivaniBhadoria" required>
                            </div>
                            <div class="col-md-5">
                                <label for="repo" class="form-label">Repository Name</label>
                                <input type="text" class="form-control" id="repo" placeholder="e.g., personal-finance-simulator" required>
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <button type="submit" class="btn btn-primary w-100">Generate Statistics</button>
                            </div>
                        </form>
                        
                        <!-- Loading indicator -->
                        <div id="loading-indicator" style="display: none;" class="mt-3">
                            <div class="d-flex align-items-center">
                                <div class="spinner-border text-primary me-2" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <span id="loading-message">Loading repository data...</span>
                            </div>
                        </div>
                        
                        <!-- Error message -->
                        <div id="error-message" class="alert alert-danger mt-3" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <div id="loading" class="loading d-none">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <span class="ms-3">Fetching repository statistics...</span>
        </div>

        <div id="stats-content" class="d-none">
            <ul class="nav nav-pills mb-3" id="stats-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="contributors-tab" data-bs-toggle="pill" data-bs-target="#contributors" type="button" role="tab">Contributors</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="files-tab" data-bs-toggle="pill" data-bs-target="#files" type="button" role="tab">File Changes</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="defects-tab" data-bs-toggle="pill" data-bs-target="#defects" type="button" role="tab">Defect Areas</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="guidelines-tab" data-bs-toggle="pill" data-bs-target="#guidelines" type="button" role="tab">PR Guidelines</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="summary-tab" data-bs-toggle="pill" data-bs-target="#summary" type="button" role="tab">Summary</button>
                </li>
            </ul>
            
            <div class="tab-content">
                <!-- Contributors Tab -->
                <div class="tab-pane fade show active" id="contributors" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    Contributors by PR Count
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="contributorChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    Average PR Open Time (hours)
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="timeOpenChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-4">
                        <div class="card-header">
                            Contributor Details
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="contributorTable">
                                    <thead>
                                        <tr>
                                            <th>Contributor</th>
                                            <th>PRs</th>
                                            <th>Lines Changed</th>
                                            <th>Avg Time Open (hours)</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Files Tab -->
                <div class="tab-pane fade" id="files" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    Most Changed Files
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="filesChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    File Changes Distribution
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="fileDistributionChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-4">
                        <div class="card-header">
                            Most Changed Files
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="filesTable">
                                    <thead>
                                        <tr>
                                            <th>File</th>
                                            <th>Changes</th>
                                            <th>PRs</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Defects Tab -->
                <div class="tab-pane fade" id="defects" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    Areas with Most Defects
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="defectsChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    Defect Distribution
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="defectDistributionChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-4">
                        <div class="card-header">
                            Defect Areas
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="defectsTable">
                                    <thead>
                                        <tr>
                                            <th>Area</th>
                                            <th>Defect Count</th>
                                            <th>Affected Files</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Guidelines Tab -->
                <div class="tab-pane fade" id="guidelines" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    PR Size Guidelines
                                </div>
                                <div class="card-body">
                                    <div class="chart-container">
                                        <canvas id="sizeGuidelineChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    PR Guidelines Summary
                                </div>
                                <div class="card-body">
                                    <ul class="list-group" id="guidelinesSummary">
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-4">
                        <div class="card-header">
                            PRs Exceeding Size Limit (300 lines)
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="sizeLimitTable">
                                    <thead>
                                        <tr>
                                            <th>PR</th>
                                            <th>Title</th>
                                            <th>Changes</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-4">
                        <div class="card-header">
                            Potential IT and Story PRs that should be clubbed
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped" id="potentialSplitsTable">
                                    <thead>
                                        <tr>
                                            <th>PR</th>
                                            <th>Title</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Summary Tab -->
                <div class="tab-pane fade" id="summary" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    Total Commits
                                </div>
                                <div class="card-body text-center">
                                    <h1 id="totalCommits" class="display-4">-</h1>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    Total PRs
                                </div>
                                <div class="card-body text-center">
                                    <h1 id="totalPRs" class="display-4">-</h1>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    Total Contributors
                                </div>
                                <div class="card-body text-center">
                                    <h1 id="totalContributors" class="display-4">-</h1>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-4">
                        <div class="card-header">
                            Repository Health Summary
                        </div>
                        <div class="card-body">
                            <div id="healthSummary"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="github-api.js"></script>
    <script src="repo-stats-ui.js"></script>
</body>
</html>
